# ---- stage 1: last ned og pakk ut MindTheGapps ----
FROM debian:bookworm-slim AS fetch
ARG GAPPS_URL="https://github.com/MindTheGapps/13.0.0-x86_64/releases/download/MindTheGapps-13.0.0-x86_64-20231025_201203/MindTheGapps-13.0.0-x86_64-20231025_201203.zip"
RUN apt-get update && apt-get install -y --no-install-recommends curl unzip ca-certificates && \
    rm -rf /var/lib/apt/lists/*
RUN curl -fL "$GAPPS_URL" -o /mtg.zip && mkdir -p /mtg && unzip -q /mtg.zip -d /mtg

# Noen arkiver har "system/..." på toppnivå, andre har "system/system/...".
# Vi kopierer konsekvent ALT under /mtg/system til /system i sluttbildet.
# (Det bevarer underkatalogene system_ext/, product/, etc slik scriptet gjør.)
# ---- stage 2: ReDroid ----
FROM redroid/redroid:13.0.0-latest
COPY --from=fetch /mtg/system/ /system/

# (valgfritt) hopp over SetupWizard hvis den blokkerer provisjonering
# RUN echo "ro.setupwizard.mode=DISABLED" >> /system/build.prop

CMD ["/init"]
